<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ - {{ analysis.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #3498db;
        }
        
        body {
            background: #f8f9fa;
            font-family: 'Cairo', 'Segoe UI', sans-serif;
        }
        
        .analysis-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .company-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }
        
        .technical-card {
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border: none;
        }
        
        .indicator-value {
            font-size: 24px;
            font-weight: bold;
        }
        
        .good { color: var(--success); }
        .bad { color: var(--danger); }
        .neutral { color: var(--warning); }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark" style="background: linear-gradient(135deg, var(--primary), var(--secondary));">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/market">
                <i class="fas fa-arrow-left me-2"></i>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªÙˆØµÙŠØ§Øª
            </a>
            <span class="text-white">
                <i class="fas fa-user-circle me-2"></i>{{ username }}
            </span>
        </div>
    </nav>
    
    <div class="container py-4">
        <div class="analysis-container">
            <!-- Ø±Ø£Ø³ Ø§Ù„Ø´Ø±ÙƒØ© -->
            <div class="company-header">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="display-6 fw-bold mb-2">{{ analysis.symbol }} - {{ analysis.name }}</h1>
                        <p class="mb-0">
                            <i class="fas fa-industry me-2"></i>{{ analysis.sector }} | 
                            <i class="fas fa-clock me-2"></i>{{ analysis.timeframe }}
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <span class="badge {% if analysis.recommendation == 'BUY' %}bg-success{% elif analysis.recommendation == 'SELL' %}bg-danger{% else %}bg-warning{% endif %} fs-5">
                            {{ analysis.recommendation }}
                        </span>
                        <div class="mt-2">
                            <h3 class="fw-bold mb-0">{{ analysis.current_price }} Ø±.Ø³</h3>
                            <small class="opacity-75">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: {{ analysis.last_update }}</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠØ© -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="technical-card text-center">
                        <h6 class="text-muted mb-3">Ø«Ù‚Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„</h6>
                        <div class="indicator-value {{ 'good' if analysis.confidence >= 70 else 'bad' if analysis.confidence < 50 else 'neutral' }}">
                            {{ analysis.confidence }}%
                        </div>
                        <div class="progress mt-2" style="height: 8px;">
                            <div class="progress-bar" 
                                 style="width: {{ analysis.confidence }}%; 
                                        background: {% if analysis.confidence >= 70 %}var(--success){% elif analysis.confidence < 50 %}var(--danger){% else %}var(--warning){% endif %};">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="technical-card text-center">
                        <h6 class="text-muted mb-3">ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø©</h6>
                        <div class="indicator-value">
                            {{ analysis.stop_loss }} Ø±.Ø³
                        </div>
                        <small class="text-muted">
                            {% set risk = analysis.current_price - analysis.stop_loss %}
                            Ù…Ø®Ø§Ø·Ø±Ø©: {{ risk|round(2) }} Ø±.Ø³
                        </small>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="technical-card text-center">
                        <h6 class="text-muted mb-3">Ù‡Ø¯Ù Ø§Ù„Ø±Ø¨Ø­</h6>
                        <div class="indicator-value">
                            {{ analysis.take_profit }} Ø±.Ø³
                        </div>
                        <small class="text-muted">
                            {% set profit = analysis.take_profit - analysis.current_price %}
                            Ø±Ø¨Ø­ Ù…Ø­ØªÙ…Ù„: {{ profit|round(2) }} Ø±.Ø³
                        </small>
                    </div>
                </div>
            </div>
            
            <!-- Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ÙÙ†ÙŠØ© -->
            <h4 class="fw-bold mb-4">
                <i class="fas fa-chart-bar me-2"></i>Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ÙÙ†ÙŠØ©
            </h4>
            
            <div class="row">
                <!-- RSI -->
                <div class="col-md-6 mb-3">
                    <div class="technical-card">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="fw-bold mb-0">Ù…Ø¤Ø´Ø± Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù†Ø³Ø¨ÙŠØ© (RSI)</h6>
                            <span class="indicator-value {% if analysis.technical_indicators.rsi > 70 or analysis.technical_indicators.rsi < 30 %}bad{% else %}good{% endif %}">
                                {{ analysis.technical_indicators.rsi }}
                            </span>
                        </div>
                        <div class="progress" style="height: 10px;">
                            {% set rsi_percent = (analysis.technical_indicators.rsi / 100) * 100 %}
                            <div class="progress-bar bg-danger" style="width: 30%"></div>
                            <div class="progress-bar bg-success" style="width: 40%"></div>
                            <div class="progress-bar bg-danger" style="width: 30%"></div>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <small>0</small>
                            <small>30</small>
                            <small>70</small>
                            <small>100</small>
                        </div>
                        <small class="text-muted d-block mt-2">
                            {% if analysis.technical_indicators.rsi < 30 %}
                            ğŸ“‰ ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø°Ø±ÙˆØ© Ø§Ù„Ø¨ÙŠØ¹ (ÙØ±ØµØ© Ø´Ø±Ø§Ø¡)
                            {% elif analysis.technical_indicators.rsi > 70 %}
                            ğŸ“ˆ ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø°Ø±ÙˆØ© Ø§Ù„Ø´Ø±Ø§Ø¡ (Ø§Ø­ØªÙŠØ§Ø·)
                            {% else %}
                            ğŸ“Š ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§ÙŠØ¯Ø©
                            {% endif %}
                        </small>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ù…ØªÙˆØ³Ø·Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© -->
                <div class="col-md-6 mb-3">
                    <div class="technical-card">
                        <h6 class="fw-bold mb-3">Ø§Ù„Ù…ØªÙˆØ³Ø·Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©</h6>
                        <div class="mb-2">
                            <div class="d-flex justify-content-between">
                                <small>EMA 9 Ø£ÙŠØ§Ù…:</small>
                                <span class="fw-bold">{{ analysis.technical_indicators.ema_9 }}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <small>EMA 21 ÙŠÙˆÙ…:</small>
                                <span class="fw-bold">{{ analysis.technical_indicators.ema_21 }}</span>
                            </div>
                        </div>
                        <small class="text-muted">
                            {% if analysis.current_price > analysis.technical_indicators.ema_9 and analysis.technical_indicators.ema_9 > analysis.technical_indicators.ema_21 %}
                            âœ… Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ØµØ§Ø¹Ø¯
                            {% elif analysis.current_price < analysis.technical_indicators.ema_9 and analysis.technical_indicators.ema_9 < analysis.technical_indicators.ema_21 %}
                            âš ï¸ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù‡Ø§Ø¨Ø·
                            {% else %}
                            ğŸ”„ Ø§ØªØ¬Ø§Ù‡ Ù…ØªØ°Ø¨Ø°Ø¨
                            {% endif %}
                        </small>
                    </div>
                </div>
                
                <!-- MACD -->
                <div class="col-md-6 mb-3">
                    <div class="technical-card">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="fw-bold mb-0">MACD</h6>
                            <span class="indicator-value {% if analysis.technical_indicators.macd > analysis.technical_indicators.macd_signal %}good{% else %}bad{% endif %}">
                                {{ analysis.technical_indicators.macd|round(2) }}
                            </span>
                        </div>
                        <small class="text-muted">
                            {% if analysis.technical_indicators.macd > analysis.technical_indicators.macd_signal %}
                            ğŸ“ˆ Ø¥Ø´Ø§Ø±Ø© Ø´Ø±Ø§Ø¡ (MACD ÙÙˆÙ‚ Ø®Ø· Ø§Ù„Ø¥Ø´Ø§Ø±Ø©)
                            {% else %}
                            ğŸ“‰ Ø¥Ø´Ø§Ø±Ø© Ø¨ÙŠØ¹ (MACD ØªØ­Øª Ø®Ø· Ø§Ù„Ø¥Ø´Ø§Ø±Ø©)
                            {% endif %}
                        </small>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø­Ø¬Ù… -->
                <div class="col-md-6 mb-3">
                    <div class="technical-card">
                        <h6 class="fw-bold mb-2">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù…</h6>
                        <div class="mb-2">
                            <div class="d-flex justify-content-between">
                                <small>Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:</small>
                                <span class="fw-bold">{{ "{:,}".format(analysis.technical_indicators.current_volume) }}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <small>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¬Ù…:</small>
                                <span class="fw-bold {{ 'good' if analysis.technical_indicators.volume_ratio > 150 else 'bad' if analysis.technical_indicators.volume_ratio < 50 else 'neutral' }}">
                                    {{ analysis.technical_indicators.volume_ratio }}%
                                </span>
                            </div>
                        </div>
                        <small class="text-muted">
                            {% if analysis.technical_indicators.volume_ratio > 150 %}
                            ğŸ“Š Ø­Ø¬Ù… ØªØ¯Ø§ÙˆÙ„ Ù‚ÙˆÙŠ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø­Ø±ÙƒØ©
                            {% elif analysis.technical_indicators.volume_ratio < 50 %}
                            âš ï¸ Ø­Ø¬Ù… ØªØ¯Ø§ÙˆÙ„ Ø¶Ø¹ÙŠÙ
                            {% else %}
                            ğŸ”„ Ø­Ø¬Ù… ØªØ¯Ø§ÙˆÙ„ Ø·Ø¨ÙŠØ¹ÙŠ
                            {% endif %}
                        </small>
                    </div>
                </div>
                
                <!-- ATR -->
                <div class="col-md-6 mb-3">
                    <div class="technical-card">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="fw-bold mb-0">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (ATR)</h6>
                            <span class="indicator-value">{{ analysis.technical_indicators.atr }}</span>
                        </div>
                        <small class="text-muted d-block mt-2">
                            ÙŠÙ‚ÙŠØ³ Ø§Ù„ØªÙ‚Ù„Ø¨: {% if analysis.technical_indicators.atr > analysis.current_price * 0.02 %}
                            ğŸ“ˆ ØªÙ‚Ù„Ø¨ Ø¹Ø§Ù„ÙŠ
                            {% else %}
                            ğŸ“Š ØªÙ‚Ù„Ø¨ Ø·Ø¨ÙŠØ¹ÙŠ
                            {% endif %}
                        </small>
                    </div>
                </div>
                
                <!-- Ù…Ù„Ø®Øµ Ø§Ù„ØªÙˆØµÙŠØ© -->
                <div class="col-md-6 mb-3">
                    <div class="technical-card">
                        <h6 class="fw-bold mb-3">Ù…Ù„Ø®Øµ Ø§Ù„ØªÙˆØµÙŠØ©</h6>
                        <div class="alert {% if analysis.recommendation == 'BUY' %}alert-success{% elif analysis.recommendation == 'SELL' %}alert-danger{% else %}alert-warning{% endif %}">
                            <h6 class="fw-bold">
                                {% if analysis.recommendation == 'BUY' %}
                                ğŸŸ¢ ØªÙˆØµÙŠØ© Ø´Ø±Ø§Ø¡
                                {% elif analysis.recommendation == 'SELL' %}
                                ğŸ”´ ØªÙˆØµÙŠØ© Ø¨ÙŠØ¹
                                {% else %}
                                ğŸŸ¡ Ù…Ø­Ø§ÙŠØ¯ (Ø§Ù†ØªØ¸Ø§Ø±)
                                {% endif %}
                            </h6>
                            <p class="mb-2">Ù†Ø³Ø¨Ø© Ø§Ù„Ø«Ù‚Ø©: <strong>{{ analysis.confidence }}%</strong></p>
                            <p class="mb-0">Ø§Ù„ØªÙˆÙ‚ÙŠØª: <strong>{{ analysis.timeframe }}</strong></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ØªÙˆØµÙŠØ© -->
            {% if analysis.reasons %}
            <div class="technical-card mt-3">
                <h5 class="fw-bold mb-3">
                    <i class="fas fa-list-check me-2"></i>Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ØªÙˆØµÙŠØ©
                </h5>
                <ul class="list-group list-group-flush">
                    {% for reason in analysis.reasons %}
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-check-circle me-3 text-success"></i>
                        {{ reason }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
            <div class="alert alert-info mt-4">
                <h6 class="fw-bold">
                    <i class="fas fa-lightbulb me-2"></i>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©
                </h6>
                <ul class="mb-0">
                    <li>Ù‡Ø°Ù‡ Ø§Ù„ØªÙˆØµÙŠØ§Øª ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ ÙˆÙ„Ø§ ØªØ¶Ù…Ù† Ø§Ù„Ø±Ø¨Ø­</li>
                    <li>ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹</li>
                    <li>Ø§Ù„ØªÙˆØµÙŠØ© ØµØ§Ù„Ø­Ø© Ù„Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙ‚Ø·</li>
                    <li>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ù„ÙŠÙ„: {{ analysis.analysis_time }}</li>
                </ul>
            </div>
            
            <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
            <div class="d-flex justify-content-between mt-4">
                <a href="/market" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-right me-2"></i>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªÙˆØµÙŠØ§Øª
                </a>
                <div>
                    <button onclick="window.print()" class="btn btn-outline-secondary me-2">
                        <i class="fas fa-print me-2"></i>Ø·Ø¨Ø§Ø¹Ø©